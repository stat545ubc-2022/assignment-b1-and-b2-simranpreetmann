---
title: "Assignment B1"
output: html_document
date: "2022-11-03"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(datateachr)
library(tidyverse)
library(testthat)
```

# Exercise 1 & 2: Creating and Documenting the Function -----------------------------------------
```{r}
#' Optimal Histogram
#'
#' Creates a histogram with the optimal bin-width, as defined by the Freedman-Diaconis rule. A wrapper for \code{geom_histogram()}.
#'
#' @param x A vector of class "numeric". This parameter is named \code{x} because it represents the numerical variable that will be plotted on this histogram.
#' @param axis An object of class "character", indicating the x-axis label. This parameter is named \code{axis} because its input is used create the label of the x-axis of the histogram.
#' @param ... Other parameters to pass to \code{geom_histogram()}
#'
#' @return A histogram plot that visualizes the distribution of \code{x}
#' @export
optimal_histogram <- function(x, axis, ...) {
  if (length(x) == 0) {
    warning("length of *x* must be greater than 0!")
    return(x)
  }
  stopifnot(is.na(x) | is.numeric(x))
  stopifnot(is.character(axis))
  
  x <- na.omit(x)
  
  optimal_bin_width <- ((IQR(x)) * 2) / (length(x)^(1 / 3))
  ggplot(mapping = aes(x)) +
    geom_histogram(binwidth = optimal_bin_width, ...) +
    labs(x = axis, y = "Count") +
    theme_linedraw()
}
```

# Exercise 3: Examples --------------------------------------------------------------------------

Example # 1: Below is the most basic usage of the optimal_histogram() function. It contains only the 2 necessary arguments (x, axis).
```{r}
example_1 <- optimal_histogram(vancouver_trees$diameter, "Diameter of Tree at Breast Height (ft)")

print(example_1)
```

Example 2: The example below demonstrates the use of additional arguments (...) to further modify the histogram that is produced
```{r}
example_2 <- optimal_histogram(cancer_sample$radius_mean, "Mean Radius of Biopsy Sample", fill = "darkgoldenrod4", color = "darkgoldenrod3", alpha = 0.5)

print(example_2)
```

Example 3: The example below shows that an error is produced when a categorical variable (species names of vancouver trees) is passed to the parameter x
```{r, error = TRUE}
example_3 <- optimal_histogram(vancouver_trees$species_name, "Species")

print(example_3)
```

# Exercise 4: Test the Function ------------------------------------------------------------
```{r}
test_that("Function returns a ggplot object", {
  expect_s3_class(optimal_histogram(c(2, 3, 3, 3, 3, 4, 2, 2, 5, 5, 5, 5, 3), "Numbers"), "ggplot")
  expect_s3_class(optimal_histogram(vancouver_trees$height_range_id, "Height Range ID"), "ggplot")
  expect_s3_class(optimal_histogram(cancer_sample$radius_mean, "Radius"), "ggplot")
})

test_that("Function returns a ggplot object even when x contains NAs", {
  expect_true(is.ggplot(optimal_histogram(c(2, 3, 3, 3, NA, 4, 2, 2, 5, 5, 5, 5, 3), "Numbers")))
  expect_true(is.ggplot(optimal_histogram(c(2, 3, 3, NA, NA, 4, NA, 2, 5, 5, 5, 5, 3), "Numbers")))
})

test_that("Function returns error if non-numeric input passed to x", {
  expect_error(optimal_histogram(c(2, 3, 3, 3, 4, 4, 2, 2, 5, 5, "B", "C", 5, 5, 3), "Random Numbers and Letters"))
  expect_error(optimal_histogram(vancouver_trees$genus_name, "Genus Name"))
  expect_error(optimal_histogram(vancouver_trees$plant_area, "Plant Area"))
})

test_that("Function returns error if argument passed to axis is not of type character", {
  expect_error(optimal_histogram(c(2, 3, 3, 3, 4, 4, 2, 2, 5, 5, 5, 5, 3), Numbers))
  expect_error(optimal_histogram(c(2, 3, 3, 3, 4, 4, 2, 2, 5, 5, 5, 5, 3), 3, ))
  expect_error(optimal_histogram(c(2, 3, 3, 3, 4, 4, 2, 2, 5, 5, 5, 5, 3), 3.4))
  expect_error(optimal_histogram(vancouver_trees$diameter, 3.4))
})

test_that("Function returns warning message if vector of length zero passed to x", {
  expect_warning(optimal_histogram(c(), "No Numbers"), label = "length of x must be greater than 0")
})

```


